trigger: none

pr:
  autoCancel: false
  branches:
    include:
      - main
      - feature/*
      - issue/*

variables:
  - group: django_gh
  - group: django-dev

pool:
  vmImage: ubuntu-latest

stages:
  - stage: ValidateBicep
    dependsOn:
    displayName: Bicep Validation
    jobs:
      - template: validate_bicep.yml

  - stage: BuildWebApp
    dependsOn:
    displayName: Build Web App
    jobs:
      - job: BuildWebApp
        displayName: Build Web App
        variables:
          - group: django-superuser
        steps:
          - checkout: self
            submodules: true
            persistCredentials: true
          - template: build_webapp.yml
          - template: run_tests.yml
