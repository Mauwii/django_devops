pr:
  drafts: true
  autoCancel: false
  paths:
    include:
      - pipelines
      - azure-pipelines.yml

variables:
  - group: django_gh
  - group: django-dev

pool:
  vmImage: ubuntu-latest

stages:

  - stage: ValidateBicep
    dependsOn:
    displayName: Bicep Validation
    jobs:
      - template: validate_bicep.yml

  - stage: BuildWebApp
    dependsOn:
    displayName: Build Web App
    jobs:
      - job: BuildWebApp
        displayName: Build Web App
        variables:
          - group: django-superuser
        steps:
          - checkout: self
            submodules: true
            persistCredentials: true
          - template: build_webapp.yml
          - template: run_tests.yml

  # - stage: RunTests
  #   dependsOn: BuildWebApp
  #   displayName: Run Tests
  #   jobs:
  #     - job: RunTests
  #       displayName: Run Django Tests
  #       variables:
  #         - group: django-dev
  #       steps:
  #         - checkout: self
  #           submodules: true
  #         - template: run_tests.yml
